(()=>{"use strict";class e{calculatorSelector="#wc-variation-price-calculator";calculatorInputSelector="#price_calculator input";pricePlaceholderSelector="span.product_price";currentVariationSelector='input[type="hidden"][name^="variation_id"]';totalAmmountSelector=".wc-measurement-price-calculator-total-amount";measurementNeededSelector='input[type="hidden"][name^="_measurement_needed"]';measurementNeededUnitSelector='input[type="hidden"][name^="_measurement_needed_unit"]';init(){jQuery(document.body).on("init_calculator",(()=>this.calculatePrice())),jQuery(document.body).on("found_variation",(()=>this.getCalculatorForm())),jQuery(document.body).on("reset_data",(()=>this.clearCalculatorForm())),jQuery(document.body).on("input",this.calculatorInputSelector,this.debounce((()=>{this.calculatePrice()}),250)),"simple"===fq_price_calculator_params.product_type&&jQuery(document.body).trigger("init_calculator")}calculatePrice(){const e=jQuery(this.currentVariationSelector).val(),a=jQuery("#price_calculator").find("input").serialize(),t=jQuery(this.pricePlaceholderSelector),r=jQuery(this.totalAmmountSelector),c=jQuery(this.measurementNeededSelector),o=jQuery(this.measurementNeededUnitSelector),u=jQuery('input[name="quantity"]');jQuery.ajax({type:"POST",url:fq_price_calculator_params.ajax_url,data:{action:"price_calculation",product_id:e||fq_price_calculator_params.product_id,form_data:a,nonce:fq_price_calculator_params.nonce},success:e=>{!0===e.success?(t.html(e.data.price_html),r.html(e.data.measurement_needed),c.val(e.data.measurement_needed),o.val(e.data.measurement_needed_unit),e.data.max_wc_quantity&&u.attr("max",e.data.max_wc_quantity),t.trigger("wc-measurement-price-calculator-total-price-change",{price:e.data.price,measurement_needed:e.data.measurement_needed,measurement_needed_unit:e.data.measurement_needed_unit,max_wc_quantity:e.data.max_wc_quantity})):(t.html(""),r.html(""),console.error("Price calculation ajax error",e.data))},error:(e,a,t)=>{console.error("Price calculation ajax error",t)}})}getCalculatorForm(){const e=jQuery(this.currentVariationSelector).val();if(!e)return;const a=jQuery(this.calculatorSelector),t=jQuery('select[name^="attribute"]').serialize();a.html(""),jQuery.ajax({type:"POST",url:fq_price_calculator_params.ajax_url,data:{action:"calculator_form",variation_id:e,variation_data:t,nonce:fq_price_calculator_params.nonce},success:e=>{!0===e.success?(a.html(e.data),jQuery(document.body).trigger("init_calculator")):console.error("Calculator form ajax error",e.data)},error:(e,a,t)=>{console.error("Calculator form ajax error",t)}})}clearCalculatorForm(){jQuery(this.calculatorSelector).html("")}debounce(e,a){let t;return function(...r){clearTimeout(t),t=setTimeout((()=>e.apply(this,r)),a)}}}jQuery((()=>{if("undefined"==typeof fq_price_calculator_params)return!1;(new e).init()}))})();